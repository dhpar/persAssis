services:
  frontend:
    command: "npm run start"
    ports: 
      - "5173:5173"
    networks:
      - apiNetwork
    build: 
      context: ./frontend
      dockerfile: Dockerfile
    develop:
      watch:
        - action: sync
          path: ./frontend
          target: /frontend/dist
          initial_sync: true
          ignore:
            - node_modules/
        - action: rebuild
          path: package.json
    volumes:
      - ./frontend:/frontend
      # Create an anonymous volume for node_modules to use the container's installed packages
      - /frontend/node_modules
    
  backend:
    build: 
      context: ./backend
      dockerfile: Dockerfile
    develop:
      watch:
        # Sync source code changes
        - path: ./backend
          action: sync
          target: ./backend
        # Rebuild if dependencies file changes
        - path: ./backend/requirements.txt
          action: rebuild
    command: "uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload"
    restart: always
    ports: 
      - "8000:8000"
    volumes:
      - ./backend:/backend
      - /backend/env
networks: 
  apiNetwork:
    driver: bridge  